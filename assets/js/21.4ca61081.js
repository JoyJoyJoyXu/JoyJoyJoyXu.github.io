(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{377:function(e,r,t){"use strict";t.r(r);var v=t(42),_=Object(v.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"react-fiber"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#react-fiber"}},[e._v("#")]),e._v(" React-Fiber")]),e._v(" "),t("h2",{attrs:{id:"fiber-æ˜¯ä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fiber-æ˜¯ä»€ä¹ˆ"}},[e._v("#")]),e._v(" Fiber æ˜¯ä»€ä¹ˆ")]),e._v(" "),t("p",[e._v("JavaScript æ˜¯å•çº¿ç¨‹çš„,è¿™æ„å‘³ç€æˆ‘ä»¬åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œæ‰€æœ‰UIæ›´æ–°,å¤„ç†ç”¨æˆ·æ“ä½œå’Œç½‘ç»œè°ƒç”¨ç­‰ã€‚")]),e._v(" "),t("p",[e._v("åœ¨ Fiber ä¹‹å‰ React æœ‰ä¸¤æ£µæ ‘ğŸŒ²,ä¸€æ£µæ˜¯å½“å‰æ ‘,å¦ä¸€æ£µæ˜¯å¸¦æœ‰æ‰€æœ‰æ–°æ›´æ–°çš„æ›´æ–°æ ‘ğŸŒ²ã€‚ åè°ƒå™¨å°†åœ¨ä¸€æ¬¡é€šè¿‡ä¸­åŒæ­¥æ‰¾åˆ°ä¸¤ä¸ªæ ‘ğŸŒ²ä¹‹é—´çš„å·®å¼‚,è¿™ä¸ªè¿‡ç¨‹ä¸èƒ½è¢«æ‰“æ–­,å¾—å…¨éƒ¨æ‰§è¡Œå®Œä¸€æŠŠæ¢­æ›´æ–°, èŠ‚ç‚¹è¿‡å¤šä¼šå¯¼è‡´å¡é¡¿,è¿™å°†é˜»æ­¢ä¸»çº¿ç¨‹æ‰§è¡Œå…¶ä»–é‡è¦ä»»åŠ¡,ä¾‹å¦‚æŸäº›ç”¨æˆ·æ“ä½œ")]),e._v(" "),t("p",[e._v("å› æ­¤,Facebookå›¢é˜Ÿåœ¨React 16æ›´æ–°ä¸­å¼•å…¥äº†Fiberä½œä¸ºå…¶æ ¸å¿ƒæ¶æ„ã€‚")]),e._v(" "),t("p",[e._v("Fiber å°±æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„,å®ƒæœ‰å¾ˆå¤šå±æ€§,è™šæ‹Ÿ dom å°±æ˜¯å¯¹çœŸå® dom çš„ä¸€ç§ç®€åŒ– ä¸€äº›çœŸå® dom åšä¸åˆ°çš„å¯¹è±¡ è™šæ‹Ÿ dom æ›´åšä¸åˆ°ã€‚ å› æ­¤æœ‰äº† fiberã€å¸Œæœ›å€Ÿç”± fiber ä¸Šçš„è¿™å †å±æ€§ æ¥åšä¸€äº›æ¯”è¾ƒå‰å®³çš„äº‹ä»¶")]),e._v(" "),t("h2",{attrs:{id:"fiber-æ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fiber-æ¶æ„"}},[e._v("#")]),e._v(" Fiber æ¶æ„")]),e._v(" "),t("p",[e._v("ä¸ºäº†å¼¥è¡¥ä¸Šé¢çš„ä¸è¶³ã€è®¾è®¡äº†ä¸€äº›æ–°çš„ç®—æ³•ã€ä¸ºäº†è®©è¿™äº›ç®—æ³•è·‘èµ·æ¥ã€æ‰€ä»¥å‡ºç°äº† Fiber æ•°æ®ç»“æ„")]),e._v(" "),t("p",[t("strong",[e._v("Fiber")]),e._v(" æ•°æ®ç»“æ„ + ç®—æ³• = Fiber æ¶æ„")]),e._v(" "),t("p",[t("strong",[e._v("React")]),e._v(" åº”ç”¨ä»å§‹è‡³ç»ˆ ç®¡ç†ç€æœ€åŸºæœ¬çš„ä¸‰æ ·ä¸œè¥¿")]),e._v(" "),t("p",[e._v("1ã€ Root(æ•´ä¸ªåº”ç”¨çš„æ ¹ ä¸€ä¸ªå¯¹è±¡ ä¸æ˜¯ Fiber åŒæ—¶æœ‰ä¸ªå±æ€§æŒ‡å‘ workInProgress)"),t("br"),e._v("\n2ã€ current æ ‘(æ ‘ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ Fiber ä¿å­˜çš„æ˜¯ä¸Šä¸€æ¬¡çš„çŠ¶æ€ å¹¶ä¸”æ¯ä¸ªFIberèŠ‚ç‚¹ éƒ½å¯¹åº”è¿™ä¸€ä¸ª jsx èŠ‚ç‚¹)"),t("br"),e._v("\n3ã€ workInProgress æ ‘(æ ‘ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹Fiber ä¿å­˜çš„æ˜¯æœ¬æ¬¡æ–°çš„èŠ‚ç‚¹ å¹¶ä¸”æ¯ä¸ªFiber èŠ‚ç‚¹éƒ½å¯¹åº”ä¸€ä¸ª jsx èŠ‚ç‚¹)")]),e._v(" "),t("h2",{attrs:{id:"å¦‚ä½•å·¥ä½œ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•å·¥ä½œ"}},[e._v("#")]),e._v(" å¦‚ä½•å·¥ä½œ")]),e._v(" "),t("p",[e._v("æ²¡æœ‰ current æ ‘,React åœ¨ä¸€å¼€å§‹åˆ›å»º Root å°±ä¼šåˆ›å»ºä¸€ä¸ª uninitiaFiber (æœªåˆå§‹åŒ–çš„FIber) è®© react çš„ current æŒ‡å‘ uninitiaFiber,ä¹‹åå†å»åˆ›å»ºä¸€ä¸ªæœ¬æ¬¡è¦ç”¨åˆ°çš„ workInProgress")]),e._v(" "),t("ul",[t("li",[e._v("ReactDOM.render() å’Œ setState çš„æ—¶å€™å¼€å§‹åˆ›å»ºæ›´æ–°ã€‚")]),e._v(" "),t("li",[e._v("å°†åˆ›å»ºçš„æ›´æ–°åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œç­‰å¾…è°ƒåº¦ã€‚")]),e._v(" "),t("li",[e._v("åœ¨ requestIdleCallback ç©ºé—²æ—¶æ‰§è¡Œä»»åŠ¡ã€‚")]),e._v(" "),t("li",[e._v("ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå† Fiber Nodeï¼Œå¹¶ä¸”æ„å»º WokeInProgress Treeã€‚")]),e._v(" "),t("li",[e._v("ç”Ÿæˆ effectListã€‚")]),e._v(" "),t("li",[e._v("æ ¹æ® EffectList æ›´æ–° DOMã€‚")])]),e._v(" "),t("p",[e._v("WorkInProgress Tree æ„é€ å®Œæ¯•ï¼Œå¾—åˆ°çš„å°±æ˜¯æ–°çš„ Fiber Tree,ç„¶åå–œæ–°åŒæ—§ï¼ˆæŠŠ current æŒ‡é’ˆæŒ‡å‘ WorkInProgress Treeï¼Œä¸¢æ‰æ—§çš„ Fiber Treeï¼‰å°±å¥½äº†ã€‚")]),e._v(" "),t("p",[e._v("è¿™æ ·åšçš„å¥½å¤„ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("èƒ½å¤Ÿå¤ç”¨å†…éƒ¨å¯¹è±¡ï¼ˆfiberï¼‰")]),e._v(" "),t("li",[e._v("èŠ‚çœå†…å­˜åˆ†é…ã€GCçš„æ—¶é—´å¼€é”€")])]),e._v(" "),t("p",[e._v("å°±ç®—è¿è¡Œä¸­æœ‰é”™è¯¯ï¼Œä¹Ÿä¸ä¼šå½±å“ View ä¸Šçš„æ•°æ®")]),e._v(" "),t("p",[e._v("æ¯ä¸ª Fiberä¸Šéƒ½æœ‰ä¸ª alternateå±æ€§,ä¹ŸæŒ‡å‘ä¸€ä¸ª Fiber,åˆ›å»º WorkInProgress èŠ‚ç‚¹æ—¶ä¼˜å…ˆå– alternate,æ²¡æœ‰çš„è¯å°±åˆ›å»ºä¸€ä¸ªã€‚")]),e._v(" "),t("p",[e._v("åˆ›å»º WorkInProgress Tree çš„è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ª Diff çš„è¿‡ç¨‹ï¼ŒDiff å®Œæˆä¹‹åä¼šç”Ÿæˆä¸€ä¸ª Effect List,è¿™ä¸ª Effect List å°±æ˜¯æœ€ç»ˆ Commit é˜¶æ®µç”¨æ¥å¤„ç†å‰¯ä½œç”¨çš„é˜¶æ®µã€‚")]),e._v(" "),t("h2",{attrs:{id:"react-ä¸»è¦åˆ†ä¸¤ä¸ªé˜¶æ®µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#react-ä¸»è¦åˆ†ä¸¤ä¸ªé˜¶æ®µ"}},[e._v("#")]),e._v(" React ä¸»è¦åˆ†ä¸¤ä¸ªé˜¶æ®µ")]),e._v(" "),t("p",[t("img",{attrs:{src:"/img/lifecycle.png",alt:"å›¾ç‰‡2",title:"ReactChildren"}})]),e._v(" "),t("p",[e._v("1.render é˜¶æ®µ æŒ‡çš„æ˜¯åˆ›å»º fiber è¿‡ç¨‹")]),e._v(" "),t("ul",[t("li",[e._v("ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºæ–°çš„ fiber(workInProgress) å¯èƒ½æ˜¯å¤ç”¨ ç”Ÿæˆä¸€æ£µæœ‰æ–°çŠ¶æ€çš„ workInProgress æ ‘")]),e._v(" "),t("li",[e._v("åˆæ¬¡æ¸²æŸ“çš„æ—¶å€™(æˆ–æ–°åˆ›å»ºäº†æŸä¸ªèŠ‚ç‚¹) ä¼šå°†è¿™ä¸ª fiber åˆ›å»ºçœŸå®çš„dom å®ä¾‹,å¹¶ä¸”å¯¹å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹è¿›è¡Œæ’å…¥ appendchild")]),e._v(" "),t("li",[e._v("å¦‚æœä¸æ˜¯åˆæ¬¡æ¸²æŸ“çš„è¯ å°±å¯¹æ¯”æ–°æ—§çš„ fiber çŠ¶æ€ å°†äº§ç”Ÿäº†æ›´æ–°çš„fiberèŠ‚ç‚¹ æœ€ç»ˆé€šè¿‡é“¾è¡¨çš„å½¢å¼æŒ‚åœ¨åˆ° RootFiber")])]),e._v(" "),t("p",[e._v("2.commit é˜¶æ®µ æ‰æ˜¯çœŸæ­£è¦æ“ä½œé¡µé¢çš„é˜¶æ®µ")]),e._v(" "),t("ul",[t("li",[e._v("æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ")]),e._v(" "),t("li",[e._v("ä¼šä» RootFiber ä¸Šè·å–åˆ°é‚£æ¡é“¾è¡¨ æ ¹æ®é“¾è¡¨ä¸Šçš„æ ‡è¯† æ¥æ“ä½œé¡µé¢")])]),e._v(" "),t("p",[e._v("åœ¨æ¸²æŸ“é˜¶æ®µè°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("getDerivedStateFromProps")]),e._v(" "),t("li",[e._v("shouldComponentUpdate")]),e._v(" "),t("li",[e._v("render")])]),e._v(" "),t("p",[e._v("ä¸ç®¡æ˜¯åˆæ¬¡æ¸²æŸ“è¿˜æ˜¯æ›´æ–° éƒ½æ˜¯ä»æ ¹å¾€ä¸‹éå†çš„")]),e._v(" "),t("p",[e._v("åœ¨æäº¤é˜¶æ®µè°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("getSnapshotBeforeUpdate")]),e._v(" "),t("li",[e._v("componentDidMount")]),e._v(" "),t("li",[e._v("componentDidUpdate")]),e._v(" "),t("li",[e._v("componentWillUnmount\nç”±äºè¿™äº›æ–¹æ³•åœ¨æäº¤é˜¶æ®µè¢«è°ƒç”¨ï¼Œå› æ­¤å®ƒä»¬å¯èƒ½åŒ…å«ä»»ä½•å‰¯ä½œç”¨å’ŒDOMæ“ä½œæ“ä½œ")])]),e._v(" "),t("blockquote",[t("p",[e._v("ğŸŒŸ è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œé˜¶æ®µ1ï¼ˆæ¸²æŸ“ï¼‰å¯ä»¥æš‚åœå’Œæ¢å¤ï¼Œå³ï¼Œå®ƒæ˜¯å¼‚æ­¥çš„ï¼Œè€Œé˜¶æ®µ2å¿…é¡»åœ¨ä¸€ä¸ªæµç¨‹ä¸­å®Œæˆï¼ˆåŒ")]),e._v(" "),t("p",[e._v("æ­¥ï¼‰ã€‚ğŸŒŸ")])]),e._v(" "),t("h2",{attrs:{id:"prioritization"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prioritization"}},[e._v("#")]),e._v(" Prioritization")]),e._v(" "),t("p",[e._v("Reactç³»ç»Ÿå¦‚ä½•ç¡®å®šè¦æš‚åœ/æ¢å¤å“ªä¸ªè¿›ç¨‹?")]),e._v(" "),t("p",[t("strong",[e._v("ä¼˜å…ˆçº§")]),e._v(" æ˜¯React Fiberæœ€é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ Fiber Reconcilerä¸ºä»»åŠ¡åˆ†é…ä¼˜å…ˆçº§ï¼Œå¹¶æ ¹æ®ä¼˜å…ˆçº§å°†æ›´æ–°è¿™äº›æ›´æ”¹")]),e._v(" "),t("p",[e._v("æ ¹æ®ä»»åŠ¡ï¼ŒReactåˆ†é…ä»¥ä¸‹ä¼˜å…ˆçº§:")]),e._v(" "),t("ul",[t("li",[e._v("åŒæ­¥")]),e._v(" "),t("li",[e._v("é«˜ä¼˜å…ˆçº§")]),e._v(" "),t("li",[e._v("ä½ä¼˜å…ˆçº§")]),e._v(" "),t("li",[e._v("åœºå¤–å·¥ä½œ(ä¼˜å…ˆ)ç­‰")])]),e._v(" "),t("p",[e._v("ä¾‹å¦‚,åœ¨æ‰€æœ‰ç»„ä»¶çš„ä¼˜å…ˆçº§ä¸­ï¼Œå°†textInputç±»å‹äº‹ä»¶æŒ‡å®šä¸ºé«˜ä¼˜å…ˆçº§ã€‚")]),e._v(" "),t("p",[e._v("æŒ‰ç…§ä¼˜å…ˆçº§æ‰§è¡Œ,å¦‚æœæ’å…¥äº†æ–°çš„ä»»åŠ¡,é‚£ä¹ˆä¹ŸæŒ‰ç…§ä¼˜å…ˆçº§é‡æ–°æ’åº,åˆ†åˆ«æ˜¯ "),t("code",[e._v("window.requestAnimationFrame")]),e._v(" å’Œ "),t("code",[e._v("window.requestIdleCallback")])])])}),[],!1,null,null,null);r.default=_.exports}}]);